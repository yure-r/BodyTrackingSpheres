<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<!--    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils_3d@0.2/landmark_grid.css" crossorigin="anonymous"> -->
  <meta charset="utf-8">
  <script src="allthree.js"></script>
  <script src="/script4-json6-mediapipe-noorbit-window.js" defer></script>
  
  <link rel="icon" href="favicon.ico">
<!--   <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.5/control_utils.css" crossorigin="anonymous"> -->

<!--   <link rel="stylesheet" type="text/css" href="demo.css" crossorigin="anonymous"> -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js" crossorigin="anonymous"></script>
<!--   <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils_3d@0.2/control_utils_3d.js" crossorigin="anonymous"></script> -->
      <script type="text/javascript" src="./socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.5/control_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3/drawing_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.4/pose.js" crossorigin="anonymous"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/typescript/4.3.5/typescript.min.js" integrity="sha512-nf9AaqSCBbNzNqik9bkHt3+LCL50vkUxPw6GBLZ513kaAZcak9HXqRgi/EB7+NOTjFShFefWvzwzlE89jZxt9g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
  

       <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://use.typekit.net/brg5ikl.css">
<!-- Load d3.js -->
<!-- <script src="https://d3js.org/d3.v4.js"></script> -->

<!-- Load color scale -->
<!-- <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script> -->
          
  
 </head>
<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>
    <div id="my_dataviz2"></div>
    
      <div id="tooltip" class="opacity0">
        <div id="tooltip-hero">
      
    </div>
    <div id="tooltip-title">
      
    </div>
    <div id="tooltip-desc">
      
    </div>
    </div>
    
    <div id="sliderxcontainer" class="slidercontainer" style="display:none;">
  <input type="range" min="1" max="1350" value="590" class="slider" id="sliderx">
<div id="sliderxamount">
  
      </div>
    </div>
    <input style="position: absolute; top:20px; right: 140px;" type="checkbox" id="myCheck">
  
  
  <style>
  @keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.abs {
  position: absolute;
}

a {
  color: white;
  text-decoration: none;
}
a:hover {
  color: lightblue;
}

body {
  bottom: 0;
  font-family: "Titillium Web", sans-serif;
  color: white;
  left: 0;
  margin: 0;
  position: absolute;
  right: 0;
  top: 0;
  transform-origin: 0px 0px;
  overflow: hidden;
}

.container {
    position: relative;
/*     bottom: 20px; */
/*     left: 20px; */
    /* background-color: #596e73; */
    height: 100%;
    width: fit-content;
    height: -moz-fit-content;
    width: -moz-fit-content;
    display: Flex;
    flex-direction: row;
    margin: auto;
    margin-top: 0vh;
}

.input_video {
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}
.input_video.selfie {
  transform: scale(-1, 1);
}

.input_image {
  position: absolute;
}

.canvas-container {
  display: flex;
  height: 100%;
  width: 100%;
  justify-content: center;
  align-items: center;
}

.output_canvas {
width: auto;
    height: 22vh;
    display: block;
    position: absolute;
    left: 0;
    top: 0;
    -webkit-flex: 1;
    margin: auto;
    border: 1px solid #a5a1a1;
    background-color: white;
}

.logo {
  bottom: 10px;
  right: 20px;
  display: none;
}
.logo .title {
  color: white;
  font-size: 28px;
}
.logo .subtitle {
  position: relative;
  color: white;
  font-size: 10px;
  left: -30px;
  top: 20px;
}

.control-panel {
    position: absolute;
    left: 11px;
    top: 7px;
    display: flex;
    flex-direction: column;
    width: 57vw;
    color: black;
    display: none;
}
    
    #c{
      right: 0px;
/*       position: absolute; */
      border: 1px solid black;
      margin: auto;
    }
    
    .dropdown-options {
    display: flex;
    flex-direction: column;
    margin-top: 10px;
    cursor: pointer;
}
    
    span.file-selection {
    display: none;
}

.loading {
  display: flex;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  align-items: center;
  backface-visibility: hidden;
  justify-content: center;
  opacity: 1;
  transition: opacity 1s;
}
.loading .message {
  font-size: x-large;
}
.loading .spinner {
  position: absolute;
  width: 120px;
  height: 120px;
  animation: spin 1s linear infinite;
  border: 32px solid #bebebe;
  border-top: 32px solid #3498db;
  border-radius: 50%;
}

.loaded .loading {
  opacity: 0;
}
    
    .square-box{
          color: black;
    }
    
    .controls{
      height: 40px;
      width: 40px;
      filter: invert(1);
    }
    
    .landmark-grid-js {
display: flex;
    flex-direction: row;
}

.shoutout {
  left: 0;
  right: 0;
  bottom: 40px;
  text-align: center;
  font-size: 24px;
  position: absolute;
  display: none;
}
    
    .containerChild{
      display: flex;
      flex-direciton: column;
      flex-wrap: wrap;
    }
    
    span.landmark-label-js {
    white-space: nowrap;
}
  </style>
  
  
<body>
  <style>
.square-box {
    width: 33vh;
    height: fit-content;
    /* padding-top: 33%; */
    /* position: absolute; */
    left: 100%;
    bottom: 0px;
    display: flex;
    flex-direction: column-reverse;
}

    .landmark-grid-container {
    height: 33vh;
    width: 100%;
    /* position: absolute; */
    /* bottom: 0; */
    /* left: 0; */
/*     background-color: #99999999; */
    }
    
.positionData {
    /* position: absolute; */
    bottom: 4px;
    right: 0px;
    text-align: right;
    width: fit-content;
    height: 100%;
    display: flex;
    flex-direction: column;
    font-size: 0.9vh;
    line-height: 0.9vh;
    color: black;
    margin-left: 45px;
}
    
    .positionData span{
      align-self: flex-end;
    }
    
    span.labelText {
    margin-bottom: 0.9vh;
}
    
    .flexspan{
    display: flex;
    /* margin-bottom: 16px; */
    border-top: 0.1VH solid black;
    padding-top: 0.4VH;
    padding-bottom: 0.4VH;
    /* WIDTH: 100%;*/
    }
    
    span.xData {
    /* text-align: start; */
    text-align: left!IMPORTANT;
    WIDTH: 90%;
}
    
    
.positionData span {
    display: flex;
    margin-right: 5px;
    width: 100%;
}
    span.labelText {
    place-content: flex-end;
        margin-right: 14px;
}
    
    video {
    height: 10vh!important;
    width: auto;
    bottom: -60vh;
    left: 20px;
    position: absolute;
/*       display:none; */
}
    
    .inputs {
/*     height: 10vh!important; */
/*     width: auto; */
}
    
    .boldIndex{
         margin-right: 5px;
    }
  </style>
    <style>
span.datacontainer {
    display: flex;
    flex-direction: column;
    flex-wrap: nowrap;
    text-wrap: nowrap;
    white-space: nowrap;
    /* position: absolute; */
    /* margin-top: -20px; */
    right: -114px;
    /* margin-bottom: -30px; */
    width: 70px;
}
  </style>
  <div class="container">
    <video class="input_video"></video>
    <div>
    <canvas id="c" style="height:100vh; width:100vw;"></canvas>
    <canvas class="output_canvas" width="1280px" height="720px"></canvas>
    </div>
    <script>
    function toggleData(){
      console.log("clicked!")
document.getElementsByClassName("positionData")[0].classList.toggle("display")
    }
    </script>
    <style>
      .positionButton{
    height: fit-content;
    padding: 30px;
    color: black;
    background-color: gainsboro;
    z-index: 999;
    cursor: pointer;
    position: fixed;
    right: 0px;
    top: 0px;
        display: none;
      }
      
      .display{
        display: none;
      }
      
      .output_canvas{
/*         display: none; */
      }
    </style>
    <div class="positionButton" onclick="toggleData();">
      =
    </div>
         <div class="positionData display">
     <span class="flexspan" id="0"> <span class="labelText"> <b class="boldIndex">NOSE</b>[0]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="1"> <span class="labelText"> RIGHT_<b class="boldIndex">EYE_INNER</b>[1]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="2"> <span class="labelText"> RIGHT_<b class="boldIndex">EYE</b>[2]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="3"> <span class="labelText"> RIGHT_<b class="boldIndex">EYE_OUTER</b>[3]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="4"> <span class="labelText"> LEFT_<b class="boldIndex">EYE_INNER</b>[4]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="5"> <span class="labelText"> LEFT_<b class="boldIndex">EYE</b>[5]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="6"> <span class="labelText"> LEFT_<b class="boldIndex">EYE OUTER</b>[6]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="7"> <span class="labelText"> RIGHT_<b class="boldIndex">EAR</b>[7]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="8"> <span class="labelText"> LEFT_<b class="boldIndex">EAR</b>[8]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="9"> <span class="labelText"> MOUTH_<b class="boldIndex">LEFT</b>[9]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="10"><span class="labelText">MOUTH_<b class="boldIndex">RIGHT </b>[10]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="11"><span class="labelText">RIGHT_<b class="boldIndex">SHOULDER </b>[11]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
     <span class="flexspan" id="12"><span class="labelText">LEFT_<b class="boldIndex">SHOULDER </b>[12]:</span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="13"><span class="labelText">RIGHT_<b class="boldIndex">ELBOW </b>[13]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="14"><span class="labelText">LEFT_<b class="boldIndex">ELBOW </b>[14]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="15"><span class="labelText">RIGHT_<b class="boldIndex">WRIST </b>[15]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="16"><span class="labelText">LEFT_<b class="boldIndex">WRIST </b>[16]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="17"><span class="labelText">RIGHT_<b class="boldIndex">PINKY </b>[17]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="18"><span class="labelText">LEFT_<b class="boldIndex">PINKY </b>[18]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="19"><span class="labelText">RIGHT_<b class="boldIndex">INDEX </b>[19]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="20"><span class="labelText">LEFT_<b class="boldIndex">INDEX </b>[20]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="21"><span class="labelText">RIGHT_<b class="boldIndex">THUMB </b>[21]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="22"><span class="labelText">LEFT_<b class="boldIndex">THUMB </b>[22]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="23"><span class="labelText">RIGHT_<b class="boldIndex">HIP </b>[23]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="24"><span class="labelText">LEFT_<b class="boldIndex">HIP </b>[24]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="25"><span class="labelText">RIGHT_<b class="boldIndex">KNEE </b>[25]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="26"><span class="labelText">LEFT_<b class="boldIndex">KNEE </b>[26]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="27"><span class="labelText">RIGHT_<b class="boldIndex">ANKLE </b>[27]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="28"><span class="labelText">LEFT_<b class="boldIndex">ANKLE </b>[28]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="29"><span class="labelText">RIGHT_<b class="boldIndex">HEEL </b>[29]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="30"><span class="labelText">LEFT_<b class="boldIndex">HEEL </b>[30]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="31"><span class="labelText">RIGHT_<b class="boldIndex">FOOT_INDEX </b>[31]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
       <span class="flexspan" id="32"><span class="labelText">LEFT_<b class="boldIndex">FOOT_INDEX </b>[32]: </span><span class="datacontainer"><span class="xData"></span><span class="visibilityData"></span> </span></span>
        </div>
    
    <div class="loading">
      <div class="spinner"></div>
      <div class="message">
        Loading
      </div>
    </div>
    
    <a class="abs logo" href="http://www.mediapipe.dev" target="_blank">
      <div style="display: flex;align-items: center;bottom: 0;right: 10px;">
        <img class="logo" src="logo_white.png" alt="" style="
          height: 50px;">
        <span class="title">MediaPipe</span>
      </div>
    </a>
    <div class="shoutout">
      <div>
        <a href="https://solutions.mediapipe.dev/pose">
          Click here for more info
        </a>
      </div>
    </div>
  </div>
  <div class="control-panel">
  </div>
  <div class='square-box'>
    <div class="landmark-grid-container">
    </div>
  </div>
  
  <style>
    #ALLogo{
      position: absolute;
      pointer-events: none;
      height: auto;
      width: 10vw;
      bottom: 40px;
      left: 40px;
    }
    
    #CULogo{
      position: absolute;
      pointer-events: none;
      height: auto;
      width: 10vw;
      bottom: 40px;
      right: 40px;
    }
  
  </style>
  
  <img src="https://cdn.glitch.me/3972d6f4-892b-4df1-adda-0da6e2ddf320%2FREAL_AL_LOGO-65.svg?v=1633552631684" id="ALLogo">
  <img src="https://cdn.glitch.com/3972d6f4-892b-4df1-adda-0da6e2ddf320%2FAL-LOGOS-66-66-66-66-66-66-66.svg?v=1632713441490" id="CULogo">
  <img src="https://cdn.glitch.me/3972d6f4-892b-4df1-adda-0da6e2ddf320%2Fdownload%20-%202021-10-23T205023.477.png?v=1635036657588" id="QRCODE">
  <style>
    #QRCODE{
      width: 7vw;
      height: auto;
      top: 20px;
      right:20px;
      position: absolute;
    }
  </style>
  </body>
  
  <script>
  "use strict";
    const socket = io.connect("https://autonomylab-blazepose-bodytracking.glitch.me"); 
const controls1 = window;
// const LandmarkGrid = window.LandmarkGrid;
const drawingUtils = window;
const mpPose = window;
const poseOptions = {
    locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.4/${file}`;
    }
};
// Our input frames will come from here.
const videoElement = document.getElementsByClassName('input_video')[0];
const canvasElement = document.getElementsByClassName('output_canvas')[0];
const controlsElement = document.getElementsByClassName('control-panel')[0];
const canvasCtx = canvasElement.getContext('2d');
// We'll add this to our control panel later, but we'll save it here so we can
// call tick() each time the graph runs.
const fpsControl = new controls1.FPS();
// Optimization: Turn off animated spinner after its hiding animation is done.
const spinner = document.querySelector('.loading');
spinner.ontransitionend = () => {
    spinner.style.display = 'none';
};
// const landmarkContainer = document.getElementsByClassName('landmark-grid-container')[0];
// const grid = new LandmarkGrid(landmarkContainer, {
//     connectionColor: 0xCCCCCC,
//     definedColors: [{ name: 'LEFT', value: 0xffa500 }, { name: 'RIGHT', value: 0x00ffff }],
//     range: 2,
//     fitToGrid: true,
//     labelSuffix: 'm',
//     landmarkSize: 2,
//     numCellsPerAxis: 4,
//     showHidden: false,
//     centered: true,
// });
function onResults(results) {
  // console.log(results)
  if (results.poseLandmarks){
    results.poseLandmarks[33] = document.getElementsByClassName("output_canvas")[0].height
    results.poseLandmarks[34]= document.getElementsByClassName("output_canvas")[0].width
    console.log(results.poseLandmarks[33])
      socket.emit('results',results.poseLandmarks);
  updateSpheres(results.poseLandmarks)
  
  

  for (let i = 0; i < 33; i++) {
    document.getElementById(i).children[1].children[0].innerHTML = "Y: " + JSON.stringify(results.poseLandmarks[i].y.toFixed(1)*-8)
    document.getElementById(i).children[1].children[1].innerHTML = "Vis: " + ((results.poseLandmarks[i].visibility*99.9).toFixed(1))
 
  }
    
    
  }
  
    // Hide the spinner.
    document.body.classList.add('loaded');
    // Update the frame rate.
    fpsControl.tick();
    // Draw the overlays.
    canvasCtx.save();
    canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
    // canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height); //UNCOMMENT THIS TO SHOW CAMERA OVERLAY
    if (!results.poseWorldLandmarks) {
        // grid.updateLandmarks([]);
        return;
    }
  // console.log(results.poseWorldLandmarks[0].z)
    drawingUtils.drawConnectors(canvasCtx, results.poseLandmarks, mpPose.POSE_CONNECTIONS, { visibilityMin: 0.65, color: 'black' });
    drawingUtils.drawLandmarks(canvasCtx, Object.values(mpPose.POSE_LANDMARKS_LEFT)
        .map(index => results.poseLandmarks[index]), { visibilityMin: 0.65, color: 'black', fillColor: 'rgb(255,138,0)' });
    drawingUtils.drawLandmarks(canvasCtx, Object.values(mpPose.POSE_LANDMARKS_RIGHT)
        .map(index => results.poseLandmarks[index]), { visibilityMin: 0.65, color: 'black', fillColor: 'rgb(0,217,231)' });
    drawingUtils.drawLandmarks(canvasCtx, Object.values(mpPose.POSE_LANDMARKS_NEUTRAL)
        .map(index => results.poseLandmarks[index]), { visibilityMin: 0.65, color: 'black', fillColor: 'black' });
    canvasCtx.restore();
    // grid.updateLandmarks(results.poseWorldLandmarks, mpPose.POSE_CONNECTIONS, [
    //     { list: Object.values(mpPose.POSE_LANDMARKS_LEFT), color: 'LEFT' },
    //     { list: Object.values(mpPose.POSE_LANDMARKS_RIGHT), color: 'RIGHT' },
    // ]);
}
const pose = new mpPose.Pose(poseOptions);
pose.onResults(onResults);
// Present a control panel through which the user can manipulate the solution
// options.
new controls1
    .ControlPanel(controlsElement, {
    selfieMode: true,
    modelComplexity: 1,
    smoothLandmarks: true,
    minDetectionConfidence: 0.5,
    minTrackingConfidence: 0.5
})
    .add([
    new controls1.StaticText({ title: 'MediaPipe Pose' }),
    fpsControl,
    new controls1.Toggle({ title: 'Selfie Mode', field: 'selfieMode' }),
    new controls1.SourcePicker({
        onSourceChanged: () => {
            // Resets because this model gives better results when reset between
            // source changes.
            pose.reset();
        },
        onFrame: async (input, size) => {
            const aspect = size.height / size.width;
            let width, height;
            if (window.innerWidth > window.innerHeight) {
                height = window.innerHeight;
                width = height / aspect;
            }
            else {
                width = window.innerWidth;
                height = width * aspect;
            }
            canvasElement.width = width;
            canvasElement.height = height;
            await pose.send({ image: input });
        },
    }),
    new controls1.Slider({
        title: 'Model Complexity',
        field: 'modelComplexity',
        discrete: ['Lite', 'Full', 'Heavy'],
    }),
    new controls1.Toggle({ title: 'Smooth Landmarks', field: 'smoothLandmarks' }),
    new controls1.Slider({
        title: 'Min Detection Confidence',
        field: 'minDetectionConfidence',
        range: [0, 1],
        step: 0.01
    }),
    new controls1.Slider({
        title: 'Min Tracking Confidence',
        field: 'minTrackingConfidence',
        range: [0, 1],
        step: 0.01
    }),
])
    .on(x => {
    const options = x;
    videoElement.classList.toggle('selfie', options.selfieMode);
    pose.setOptions(options);
});
  
  </script>
</html>
